#!/bin/bash
# Script per compilare i moduli AMD di WhereAreYou
# Salva come compile_amd.sh nella directory del plugin

echo "=== Compilazione moduli AMD WhereAreYou ==="

# Cambia nella directory di Moodle (modifica il percorso)
MOODLE_DIR=$MOODLE
cd "$MOODLE_DIR"

echo "Directory Moodle: $(pwd)"

# Verifica che esista il file sorgente
if [ -f "local/whereareyou/amd/src/modal.js" ]; then
    echo "✅ File sorgente trovato"
else
    echo "❌ File sorgente NON trovato!"
    exit 1
fi

# Crea directory build se non esiste
mkdir -p local/whereareyou/amd/build

echo "Compilazione in corso..."

# Compila il modulo specifico
php admin/cli/build_amd.php --file=local/whereareyou/amd/src/modal.js

# Verifica risultato
if [ -f "local/whereareyou/amd/build/modal.min.js" ]; then
    echo "✅ Compilazione completata con successo!"
    echo "File generato: $(ls -la local/whereareyou/amd/build/modal.min.js)"
else
    echo "❌ Compilazione fallita!"
    echo "Prova con compilazione completa..."
    php admin/cli/build_amd.php --all
fi

# Purge cache
echo "Pulizia cache..."
php admin/cli/purge_caches.php

echo "=== Compilazione completata ==="