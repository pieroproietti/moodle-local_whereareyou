{"version":3,"file":"modal.min.js","sources":["../src/modal.js"],"sourcesContent":["/**\n * Where Are You modal functionality\n *\n * @module     local_whereareyou/modal\n * @copyright  2025\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport $ from 'jquery';\nimport 'core/modal';\nimport {get_string} from 'core/str';\nimport Ajax from 'core/ajax';\nimport Notification from 'core/notification';\nimport Templates from 'core/templates';\n\n/**\n * Initialize the modal\n * @param {Object} config Configuration object\n */\nexport const init = (config) => {\n    \n    // Wait for page to be ready\n    $(document).ready(() => {\n        showModal(config);\n    });\n};\n\n/**\n * Show the modal\n * @param {Object} config Configuration object\n */\nconst showModal = async (config) => {\n    try {\n        // Prepare template context with selected values\n        const context = {\n            ...config,\n            department_options: config.department_options.map(option => ({\n                ...option,\n                selected: option.value === config.current_department\n            })),\n            position_options: config.position_options.map(option => ({\n                ...option,\n                selected: option.value === config.current_position\n            }))\n        };\n        \n        // Render modal template\n        const html = await Templates.render('local_whereareyou/modal', context);\n        \n        // Add modal to page\n        $('body').append(html);\n        \n        // Show modal\n        const $modal = $('#whereareyou-modal');\n        $modal.modal('show');\n        \n        // Bind events\n        bindEvents($modal, config);\n        \n    } catch (error) {\n        console.error('Error showing Where Are You modal:', error);\n    }\n};\n\n/**\n * Bind modal events\n * @param {jQuery} $modal Modal jQuery object\n * @param {Object} config Configuration object\n */\nconst bindEvents = ($modal, config) => {\n    \n    // Save button click\n    $modal.find('#whereareyou-save').on('click', async function() {\n        const $button = $(this);\n        const $form = $('#whereareyou-form');\n        const department = $form.find('#department-select').val();\n        const position = $form.find('#position-select').val();\n        \n        if (!department || !position) {\n            showMessage('Per favore seleziona sia il dipartimento che la posizione.', 'warning');\n            return;\n        }\n        \n        // Disable button and show loading\n        $button.prop('disabled', true);\n        $button.html('<i class=\"fa fa-spinner fa-spin me-2\"></i>Salvataggio...');\n        \n        try {\n            const response = await $.ajax({\n                url: M.cfg.wwwroot + '/local/whereareyou/ajax.php',\n                method: 'POST',\n                data: {\n                    action: 'save',\n                    department: department,\n                    position: position,\n                    sesskey: M.cfg.sesskey\n                },\n                dataType: 'json'\n            });\n            \n            if (response.success) {\n                showMessage('Informazioni salvate con successo!', 'success');\n                \n                // Close modal after 1 second\n                setTimeout(() => {\n                    $modal.modal('hide');\n                    $modal.remove();\n                }, 1000);\n            } else {\n                throw new Error(response.error || 'Errore sconosciuto');\n            }\n            \n        } catch (error) {\n            console.error('Save error:', error);\n            showMessage('Errore nel salvare le informazioni. Riprova.', 'danger');\n        } finally {\n            // Re-enable button\n            $button.prop('disabled', false);\n            $button.html('<i class=\"fa fa-save me-2\"></i>Salva');\n        }\n    });\n    \n    // Logout button click\n    $modal.find('#whereareyou-logout').on('click', function() {\n        window.location.href = M.cfg.wwwroot + '/login/logout.php?sesskey=' + M.cfg.sesskey;\n    });\n    \n    // Prevent modal from closing on backdrop click or escape\n    $modal.on('hide.bs.modal', function(e) {\n        // Allow programmatic hiding only\n        if (!$(this).data('allow-hide')) {\n            e.preventDefault();\n            return false;\n        }\n    });\n};\n\n/**\n * Show message in modal\n * @param {string} message Message text\n * @param {string} type Alert type (success, warning, danger, info)\n */\nconst showMessage = (message, type = 'info') => {\n    const $messageDiv = $('#whereareyou-message');\n    $messageDiv\n        .removeClass('alert-success alert-warning alert-danger alert-info')\n        .addClass(`alert-${type}`)\n        .text(message)\n        .removeClass('d-none');\n    \n    // Auto-hide after 3 seconds for success messages\n    if (type === 'success') {\n        setTimeout(() => {\n            $messageDiv.addClass('d-none');\n        }, 3000);\n    }\n};\n\n"],"names":["_interopRequireDefault","e","__esModule","default","_jquery","_ajax","_notification","_templates","_exports","init","config","$","document","ready","showModal","async","context","department_options","map","option","selected","value","current_department","position_options","current_position","html","Templates","render","append","$modal","modal","bindEvents","error","console","find","on","$button","this","$form","department","val","position","prop","response","ajax","url","M","cfg","wwwroot","method","data","action","sesskey","dataType","success","Error","showMessage","setTimeout","remove","window","location","href","preventDefault","message","type","arguments","length","undefined","$messageDiv","removeClass","addClass","text"],"mappings":"sMAauC,SAAAA,uBAAAC,GAAAA,OAAAA,GAAAA,EAAAC,WAAAD,EAAAE,CAAAA,QAAAF,EAAA;;;;;;;kFALvCG,QAAAJ,uBAAAI,SAGAC,MAAAL,uBAAAK,OACAC,cAAAN,uBAAAM,eACAC,WAAAP,uBAAAO,YAYEC,SAAAC,KANmBC,UAGjB,EAAAC,iBAAEC,UAAUC,OAAM,KACdC,UAAUJ,OAAO,GACnB,EAON,MAAMI,UAAYC,eACd,IAEI,MAAMC,QAAU,IACTN,OACHO,mBAAoBP,OAAOO,mBAAmBC,KAAIC,SAAW,IACtDA,OACHC,SAAUD,OAAOE,QAAUX,OAAOY,uBAEtCC,iBAAkBb,OAAOa,iBAAiBL,KAAIC,SAAW,IAClDA,OACHC,SAAUD,OAAOE,QAAUX,OAAOc,sBAKpCC,WAAaC,WAASvB,QAACwB,OAAO,0BAA2BX,UAG/D,EAAAL,QAAAA,SAAE,QAAQiB,OAAOH,MAGjB,MAAMI,QAAS,EAAAlB,QAACR,SAAC,sBACjB0B,OAAOC,MAAM,QAGbC,WAAWF,OAAQnB,OAEtB,CAAC,MAAOsB,OACLC,QAAQD,MAAM,qCAAsCA,MACxD,GAQED,WAAaA,CAACF,OAAQnB,UAGxBmB,OAAOK,KAAK,qBAAqBC,GAAG,SAASpB,iBACzC,MAAMqB,SAAU,EAAAzB,QAACR,SAACkC,MACZC,OAAQ,EAAA3B,QAACR,SAAC,qBACVoC,WAAaD,MAAMJ,KAAK,sBAAsBM,MAC9CC,SAAWH,MAAMJ,KAAK,oBAAoBM,MAEhD,GAAKD,YAAeE,SAApB,CAMAL,QAAQM,KAAK,YAAY,GACzBN,QAAQX,KAAK,4DAEb,IACI,MAAMkB,eAAiBhC,QAACR,QAACyC,KAAK,CAC1BC,IAAKC,EAAEC,IAAIC,QAAU,8BACrBC,OAAQ,OACRC,KAAM,CACFC,OAAQ,OACRZ,WAAYA,WACZE,SAAUA,SACVW,QAASN,EAAEC,IAAIK,SAEnBC,SAAU,SAGd,IAAIV,SAASW,QAST,MAAM,IAAIC,MAAMZ,SAASX,OAAS,sBARlCwB,YAAY,qCAAsC,WAGlDC,YAAW,KACP5B,OAAOC,MAAM,QACbD,OAAO6B,QAAQ,GAChB,IAKV,CAAC,MAAO1B,OACLC,QAAQD,MAAM,cAAeA,OAC7BwB,YAAY,+CAAgD,SAChE,CAAU,QAENpB,QAAQM,KAAK,YAAY,GACzBN,QAAQX,KAAK,uCACjB,CAtCA,MAFI+B,YAAY,6DAA8D,UAyClF,IAGA3B,OAAOK,KAAK,uBAAuBC,GAAG,SAAS,WAC3CwB,OAAOC,SAASC,KAAOf,EAAEC,IAAIC,QAAU,6BAA+BF,EAAEC,IAAIK,OAChF,IAGAvB,OAAOM,GAAG,iBAAiB,SAASlC,GAEhC,KAAK,EAAAU,QAAAA,SAAE0B,MAAMa,KAAK,cAEd,OADAjD,EAAE6D,kBACK,CAEf,GAAE,EAQAN,YAAc,SAACO,SAA2B,IAAlBC,KAAIC,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,GAAG,OACjC,MAAMG,aAAc,EAAAzD,QAACR,SAAC,wBACtBiE,YACKC,YAAY,uDACZC,SAAS,SAASN,QAClBO,KAAKR,SACLM,YAAY,UAGJ,YAATL,MACAP,YAAW,KACPW,YAAYE,SAAS,SAAS,GAC/B,KAET"}