define("local_whereareyou/modal",["exports","jquery","core/modal","core/str","core/ajax","core/notification","core/templates"],(function(_exports,_jquery,_modal,_str,_ajax,_notification,_templates){function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}
/**
   * Where Are You modal functionality
   *
   * @module     local_whereareyou/modal
   * @copyright  2025
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_jquery=_interopRequireDefault(_jquery),_ajax=_interopRequireDefault(_ajax),_notification=_interopRequireDefault(_notification),_templates=_interopRequireDefault(_templates);_exports.init=config=>{(0,_jquery.default)(document).ready((()=>{showModal(config)}))};const showModal=async config=>{try{const context={...config,department_options:config.department_options.map((option=>({...option,selected:option.value===config.current_department}))),position_options:config.position_options.map((option=>({...option,selected:option.value===config.current_position})))},html=await _templates.default.render("local_whereareyou/modal",context);(0,_jquery.default)("body").append(html);const $modal=(0,_jquery.default)("#whereareyou-modal");$modal.modal("show"),bindEvents($modal,config)}catch(error){console.error("Error showing Where Are You modal:",error)}},bindEvents=($modal,config)=>{$modal.find("#whereareyou-save").on("click",(async function(){const $button=(0,_jquery.default)(this),$form=(0,_jquery.default)("#whereareyou-form"),department=$form.find("#department-select").val(),position=$form.find("#position-select").val();if(department&&position){$button.prop("disabled",!0),$button.html('<i class="fa fa-spinner fa-spin me-2"></i>Salvataggio...');try{const response=await _jquery.default.ajax({url:M.cfg.wwwroot+"/local/whereareyou/ajax.php",method:"POST",data:{action:"save",department:department,position:position,sesskey:M.cfg.sesskey},dataType:"json"});if(!response.success)throw new Error(response.error||"Errore sconosciuto");showMessage("Informazioni salvate con successo!","success"),setTimeout((()=>{$modal.modal("hide"),$modal.remove()}),1e3)}catch(error){console.error("Save error:",error),showMessage("Errore nel salvare le informazioni. Riprova.","danger")}finally{$button.prop("disabled",!1),$button.html('<i class="fa fa-save me-2"></i>Salva')}}else showMessage("Per favore seleziona sia il dipartimento che la posizione.","warning")})),$modal.find("#whereareyou-logout").on("click",(function(){window.location.href=M.cfg.wwwroot+"/login/logout.php?sesskey="+M.cfg.sesskey})),$modal.on("hide.bs.modal",(function(e){if(!(0,_jquery.default)(this).data("allow-hide"))return e.preventDefault(),!1}))},showMessage=function(message){let type=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info";const $messageDiv=(0,_jquery.default)("#whereareyou-message");$messageDiv.removeClass("alert-success alert-warning alert-danger alert-info").addClass(`alert-${type}`).text(message).removeClass("d-none"),"success"===type&&setTimeout((()=>{$messageDiv.addClass("d-none")}),3e3)}}));

//# sourceMappingURL=modal.min.js.map